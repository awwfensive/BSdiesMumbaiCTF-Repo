import ctypes
import time
import subprocess

libc = ctypes.CDLL("libc.so.6")

def generate_secret(epoch_minute):
    seed = (epoch_minute ^ 0xBADC0DE)
    libc.srand(seed)
    return ''.join([chr(ord('A') + (libc.rand() % 26)) for _ in range(15)])

current_time = int(time.time())
epoch_minute = current_time // 60

for offset in range(-3, 4):
    candidate_minute = epoch_minute + offset
    secret = generate_secret(candidate_minute)
    print(f"[?] Trying: {secret}")
    result = subprocess.run(["./main", secret], capture_output=True, text=True)
    print(result.stdout)
    if "Correct secret" in result.stdout:
        print("[+] Success! Found secret:", secret)
        break

